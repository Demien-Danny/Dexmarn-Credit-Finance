<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dexmarn's Credit Finance Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>ðŸ“Š Dexmarn's Credit Finance Dashboard</h1>
    <nav>
      <a href="home.html">Home</a>
    </nav>
  </header>

  <table id="dashboardTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Borrower</th>
        <th>Amount</th>
        <th>Profit</th>
        <th>Total Due</th>
        <th>Due Date</th>
        <th>Status</th>
        <th>Proof</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="clearAll">Clear All Applications</button>
  <button onclick="logout()">Logout</button>

  <script>
    const tableBody = document.querySelector('#dashboardTable tbody');
    let credits = JSON.parse(localStorage.getItem('creditData')) || [];

    function renderTable() {
      tableBody.innerHTML = "";
      if (credits.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='9'>No credit applications yet.</td></tr>";
        return;
      }

      credits.forEach((credit, index) => {
        tableBody.innerHTML += `
          <tr>
            <td>${index + 1}</td>
            <td>${credit.name}</td>
            <td>K${credit.amount}</td>
            <td>K${credit.profit.toFixed(2)}</td>
            <td>K${credit.totalDue.toFixed(2)}</td>
            <td>${credit.dueDate}</td>
            <td>${credit.status || "Pending"}</td>
            <td>${credit.proof ? `<a href="${credit.proof}" target="_blank">View</a>` : "N/A"}</td>
            <td>
              <button onclick="uploadProof(${index})">Upload Proof / Mark Paid</button>
              <button onclick="deleteCredit(${index})">Delete</button>
            </td>
          </tr>
        `;
      });
    }

    function uploadProof(index) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
          credits[index].status = "Paid";
          credits[index].proof = event.target.result;
          localStorage.setItem('creditData', JSON.stringify(credits));
          renderTable();
        }
        reader.readAsDataURL(file);
      };
      input.click();
    }

    function deleteCredit(index) {
      if (confirm("Are you sure you want to delete this application?")) {
        credits.splice(index, 1);
        localStorage.setItem('creditData', JSON.stringify(credits));
        renderTable();
      }
    }

    document.getElementById('clearAll').addEventListener('click', function() {
      if (confirm("Are you sure you want to clear all applications?")) {
        credits = [];
        localStorage.setItem('creditData', JSON.stringify(credits));
        renderTable();
      }
    });

    function logout() {
      window.location.href = "admin.html";
    }

    renderTable();
  </script>
</body>
</html>
